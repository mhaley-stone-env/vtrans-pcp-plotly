<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stacked Area Chart - ArcGIS + Plotly</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="chart" style="width: 100%; height: 600px;"></div>

    <script>
        // Hardcoded segment for testing
        const segment = "Main Lake";

        // ArcGIS REST Feature Layer URL
        const serviceUrl = "https://services.arcgis.com/pwNwIGBE7M7VOXjQ/arcgis/rest/services/LCB_Implementation_Model_Cumulative_Table/FeatureServer/0/query";
        const queryUrl = `${serviceUrl}?where=${encodeURIComponent("lakesegment='" + segment + "'")}&outFields=*&f=json`;

        // Fetch data
        fetch(queryUrl)
            .then(response => response.json())
            .then(data => {
                if (!data.features || data.features.length === 0) {
                    document.getElementById('chart').innerHTML = '<p>No data found.</p>';
                    return;
                }

                // Extract first row's attributes
                const attributes = data.features[0].attributes;

                // Extract all year columns (yr_2010 ... yr_2036)
                const years = Object.keys(attributes)
                    .filter(key => key.startsWith('yr_'))
                    .map(key => key.replace('yr_', ''))
                    .sort();

                const values = years.map(y => attributes[`yr_${y}`]);

                // Build the Plotly trace
                const trace = {
                    x: years,
                    y: values,
                    type: 'scatter',
                    mode: 'lines',
                    fill: 'tozeroy',
                    name: segment
                };

                const layout = {
                    title: `Implementation Model Cumulative - ${segment}`,
                    xaxis: { title: 'Year' },
                    yaxis: { title: 'Value' },
                    showlegend: true
                };

                // Render chart
                Plotly.newPlot('chart', [trace], layout);
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('chart').innerHTML = '<p>Error loading data.</p>';
            });
    </script>
</body>
</html>